setvar rechargehp 1
getres playerhp setnstate $plid hp
getres newhp sumint $playerhp $rechargehp
getres toohealthy gte $newhp $maxhp
testres $toohealthy 1 setnstate $plid hp $maxhp
testres $toohealthy 0 setnstate $plid hp $newhp