REM get item details
getres ammodrop setthing THING_ITEM $1 ammo
testres $ammodrop 0 setvar ammodrop 5

REM get current weapon
getres currweap setthing THING_PLAYER $2 weapon

REM if we have a pistol we can refill ammo
setvar pickupammo 0
testres $currweap 1 setvar pickupammo 1
testres $pickupammo 1 getres currammo setnplayer $2 ammo
testres $pickupammo 1 getres newammo sumint $ammodrop $currammo
testres $pickupammo 1 setnplayer $2 ammo $newammo

REM if we have a weapon but not pistol check if we can switch weapons and get the ammo
REM TODO finish this
setvar tryswap 0
setvar doswap 0
testresn $currweap 0 testresn $currweap 1 setvar tryswap 1


REM if we have no weapon at all give us a pistol and full ammo
setvar setusup 0
testres $currweap 0 setvar setusup 1
testres $setusup 1 setnplayer $2 ammo $ammodrop
testres $setusup 1 setnplayer $2 weapon 1


REM delete item
deleteitem $1

REM old and broke below but contains valuable code
REM check whether we should drop weapon if needed
REM getres dropdel setthing THING_PLAYER $2 dropweapondelay
REM getres dodrop gte $gametimemillis $dwd
REM getres ammodrop setthing THING_ITEM $1 ammo
REM testresn $currweap 1 exec scripts/handleplayerweapondrop $2
REM deleteitem $1
REM setnplayer $2 weapon 1
REM getres currentammo setnplayer $2 ammo
REM getres newammo sumint $ammodrop $currentammo
REM getres toomuch gte $newammo 5
REM testres $toomuch 1 setvar newammo 5
REM setnplayer $2 ammo $newammo